<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Weather Thing</title>
    <link rel="icon" type="image/png" href="./icon-v2.png">
    <link rel="apple-touch-icon" href="./icon-v2.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./icon-v2.png">

    <style>
        /* --------------------
           TYPOGRAPHY
           -------------------- */
        /* ä¸­æ–‡ä½¿ç”¨æ˜é«”ï¼ˆç³»çµ±æ˜é«” fallbackï¼‰ï¼Œè‹±æ–‡ä½¿ç”¨è¥¯ç·š */
        :root{
            --accent-red: #e50914;
            --accent-red-strong: #ff1b2d;
            --bg-black: #000000;
            --muted-white: rgba(255,255,255,0.06);
        }

        html,body{height:100%;}
        body {
            margin: 0;
            background: var(--bg-black);
            color: var(--accent-red);
            font-family: "PMingLiU", "MingLiU", "Noto Serif TC", "Times New Roman", serif;
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
            overflow-x: hidden;
            position: relative;
        }

        /* å¼·åˆ¶æŠŠæ‰€æœ‰åœ“è§’æ”¹ç‚º 0ï¼Œç¬¦åˆä½ çš„éœ€æ±‚ï¼ˆé‡å°çŸ©å½¢å…ƒä»¶ï¼‰ */
        * { border-radius: 0 !important; }

        /* è‹±æ–‡å­—é«”å°ˆç”¨é¡åˆ¥ï¼ˆå¦‚æœè¦å¥—åœ¨è‹±æ–‡æ¨™é¡Œä¸Šï¼‰ */
        .english { font-family: "Times New Roman", "Noto Serif", serif; }

        /* ä¸­æ–‡å­—é«”åŠ ç²—ï¼Œç¢ºä¿æ˜é«”æ„Ÿè¦ºåšé‡ */
        .chinese-strong { font-weight: 800; }

        /* --------------------
           è¦–è¦ºï¼šæ¨™é¡Œ/ç‹€æ…‹åˆ—
           -------------------- */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 20px;
            background: rgba(0,0,0,0.6);
            border-bottom: 2px solid rgba(229,9,20,0.2);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .title { 
            font-size: 1.25rem;
            letter-spacing: 2px;
            color: var(--accent-red-strong);
            text-shadow:
                0 0 6px rgba(229,9,20,0.45),
                0 0 12px rgba(229,9,20,0.25);
            font-weight: 900;
        }

        .location-pill{
            border: 1px solid rgba(229,9,20,0.4);
            color: var(--accent-red);
            padding: 6px 12px;
            font-weight: 700;
        }

        .update-pill{ color: rgba(229,9,20,0.9); font-size:0.85rem; }

        /* --------------------
           å®¹å™¨
           -------------------- */
        .container{
            max-width: 680px;
            margin: 20px auto;
            padding: 12px 16px 80px 16px;
        }

        /* --------------------
           Hero Cardï¼ˆæ–¹å½¢ã€ç„¡åœ“è§’ï¼‰
           -------------------- */
        .hero-card{
            background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border: 2px solid rgba(229,9,20,0.9);
            padding: 28px 18px;
            box-shadow: 0 0 40px rgba(229,9,20,0.12), inset 0 0 18px rgba(229,9,20,0.04);
            position: relative;
            margin-bottom: 18px;
        }

        .hero-period{
            position: absolute;
            top: 8px;
            left: 16px;
            background: transparent;
            color: var(--accent-red-strong);
            border: none;
            font-weight: 800;
            font-size: 0.95rem;
            text-shadow: 0 0 6px rgba(229,9,20,0.35);
        }

        .hero-temp-container{ display:flex; align-items:center; gap:12px; justify-content:flex-start; }
        .hero-icon{ font-size:4.5rem; filter: drop-shadow(0 6px 6px rgba(0,0,0,0.7)); }
        .hero-temp{ font-size:4.25rem; font-weight:900; color:var(--accent-red-strong); }
        .hero-desc{ font-size:1.2rem; margin-top:6px; color:var(--accent-red); font-weight:800; }

        /* é¡¯ç¤ºé™é›¨æ©Ÿç‡ï¼ˆç¢ºä¿å‡ºç¾ï¼‰ */
        .rain-prob { font-size:0.9rem; color: rgba(255,255,255,0.7); margin-top:6px; }

        /* --------------------
           å»ºè­°æ ¼å­ï¼ˆæ–¹å½¢ï¼‰
           -------------------- */
        .advice-grid{ display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:18px; }
        .advice-item{ background: transparent; border: 1px solid rgba(229,9,20,0.6); padding:12px; text-align:center; }
        .advice-icon{ font-size:1.8rem; }
        .advice-text{ font-weight:900; margin-top:6px; }

        /* --------------------
           ç¨å¾Œå¤©æ°£ï¼ˆæ°´å¹³æ»¾å‹•å€ï¼‰
           -------------------- */
        .section-title{ font-size:1.1rem; color:var(--accent-red); font-weight:900; margin:10px 0 8px 2px; text-shadow:0 0 6px rgba(229,9,20,0.25); }
        .scroll-container{ display:flex; gap:12px; overflow-x:auto; padding-bottom:8px; }
        .scroll-container::-webkit-scrollbar{ display:none; }

        .mini-card{ min-width:140px; border:1px solid rgba(229,9,20,0.85); padding:12px; background:transparent; text-align:center; }
        .mini-time{ font-weight:800; color:var(--accent-red-strong); margin-bottom:6px; }
        .mini-icon{ font-size:2.25rem; margin:6px 0; }
        .mini-temp{ font-weight:800; }
        .mini-rain{ font-size:0.85rem; color:rgba(255,255,255,0.75); margin-top:6px; }

        /* --------------------
           RED TITLE FILM-STYLE EFFECTï¼ˆæ›´åƒç‰‡é ­å­—æ¨£ï¼‰
           -------------------- */
        .title-headline{
            font-size:2rem;
            text-align:center;
            margin:12px 0 18px 0;
            color:var(--accent-red-strong);
            font-family: "Times New Roman", serif;
            letter-spacing:3px;
            text-shadow:
                0 0 6px rgba(229,9,20,0.9),
                0 0 18px rgba(229,9,20,0.55),
                0 0 40px rgba(255,27,45,0.25);
            font-weight:900;
        }

        /* --------------------
           VHS / NOISE OVERLAY
           -------------------- */
        .vhs-overlay {
            pointer-events: none;
            position: fixed;
            inset: 0;
            z-index: 9999;
            mix-blend-mode: screen;
            opacity: 0.18;
            background-image:
                linear-gradient(transparent 50%, rgba(255,255,255,0.02) 50%),
                repeating-linear-gradient(90deg, rgba(255,255,255,0.01) 0 1px, transparent 1px 3px),
                radial-gradient(circle at 20% 30%, rgba(255,255,255,0.03), transparent 8%),
                radial-gradient(circle at 80% 70%, rgba(255,255,255,0.02), transparent 8%);
            background-size: 100% 4px, 4px 100%, 200px 200px, 300px 300px;
            animation: vhs-scroll 6s linear infinite, grain 0.2s steps(2) infinite;
        }

        @keyframes vhs-scroll{
            from{ background-position: 0 0, 0 0, 0 0, 0 0; }
            to{ background-position: -100px 0, 0 -20px, 0 0, 0 0; }
        }

        @keyframes grain{
            0%{ opacity:0.16; }
            50%{ opacity:0.12; }
            100%{ opacity:0.18; }
        }

        /* --------------------
           é–ƒçˆ / æ•…éšœç‰¹æ•ˆ
           -------------------- */
        .flicker {
            animation: flickerAnim 3s infinite;
        }
        @keyframes flickerAnim{
            0%{ opacity:1; filter:brightness(1); }
            5%{ opacity:0.85; filter:brightness(0.9); }
            7%{ opacity:1; filter:brightness(1.05); }
            10%{ opacity:0.6; transform: translateX(-1px); }
            11%{ opacity:1; transform: translateX(0); }
            70%{ opacity:1; }
            100%{ opacity:1; }
        }

        /* çŸ­æš«æ•…éšœä½ç§»ï¼ˆæ°´å¹³åˆ‡ç‰‡ï¼‰ */
        .glitch {
            position:relative;
        }
        .glitch::before, .glitch::after{
            content: attr(data-text);
            position:absolute;
            left:0; top:0;
            width:100%;
            overflow:hidden;
            clip: rect(0, 9999px, 0, 0);
            opacity:0.8;
            color:var(--accent-red-strong);
        }
        .glitch::before{ transform: translate3d(-2px, -1px,0); text-shadow: -2px 0 rgba(0,0,0,0.6); }
        .glitch::after{ transform: translate3d(2px, 1px,0); text-shadow: 2px 0 rgba(0,0,0,0.6); }
        @keyframes glitchClip {
            0%{ clip: rect(0,9999px,0,0); }
            20%{ clip: rect(10px,9999px,40px,0); }
            40%{ clip: rect(50px,9999px,80px,0); }
            60%{ clip: rect(20px,9999px,60px,0); }
            80%{ clip: rect(0,9999px,100px,0); }
            100%{ clip: rect(0,9999px,0,0); }
        }

        .glitch.active::before, .glitch.active::after{
            animation: glitchClip 1.2s infinite linear;
        }

        /* å°è¢å¹•é©é… */
        @media (max-width:420px){ .hero-temp{ font-size:3.2rem; } .hero-icon{ font-size:3.2rem; } }

    </style>
</head>

<body>

    <div class="vhs-overlay" aria-hidden="true"></div>

    <div class="status-bar">
        <div class="title english">The Weather Thing</div>
        <div style="display:flex;gap:10px;align-items:center;">
            <div class="location-pill chinese-strong">ğŸ“ è‡ºä¸­</div>
            <div id="updateTime" class="update-pill">æ›´æ–°ä¸­...</div>
        </div>
    </div>

    <div class="container">

        <div class="title-headline flicker glitch" data-text="THE WEATHER THING">THE WEATHER THING</div>

        <div id="heroCard" class="hero-card">
            <!-- å…§å®¹ç”± JS å‹•æ…‹æ³¨å…¥ -->
            <div class="hero-period">ç¾åœ¨</div>
            <div class="hero-temp-container">
                <div class="hero-icon">â˜ï¸</div>
                <div>
                    <div class="hero-temp">--Â°</div>
                    <div class="hero-desc">è®€å–ä¸­...</div>
                    <div class="rain-prob">é™é›¨æ©Ÿç‡ï¼š--%</div>
                </div>
            </div>

            <div class="advice-grid">
                <div class="advice-item">
                    <div class="advice-icon">â˜‚ï¸</div>
                    <div class="advice-text">è¨˜å¾—å¸¶å‚˜</div>
                </div>
                <div class="advice-item">
                    <div class="advice-icon">ğŸ§¥</div>
                    <div class="advice-text">è¦–æº«åº¦å¢æ¸›è¡£ç‰©</div>
                </div>
            </div>
        </div>

        <h3 class="section-title chinese-strong">ç¨å¾Œå¤©æ°£</h3>
        <div class="scroll-container" id="futureForecasts">
            <!-- ç”± JS æ³¨å…¥å°å¡ç‰‡ï¼ŒåŒ…å«é™é›¨æ©Ÿç‡ -->
        </div>

    </div>

    <script>
        // å°å·¥å…·ï¼šéš¨æ©Ÿè§¸ç™¼ glitch/active æ•ˆæœå¢åŠ æ•…éšœæ„Ÿ
        (function glitchRunner(){
            const el = document.querySelector('.glitch');
            if(!el) return;
            function poke(){
                el.classList.add('active');
                setTimeout(()=>el.classList.remove('active'), 1200);
                // éš¨æ©Ÿå†è§¸ç™¼
                setTimeout(poke, 3500 + Math.random()*6000);
            }
            setTimeout(poke, 1200);
        })();

        const API_URL = "https://weather-taichung-bennie.zeabur.app/api/weather/kaohsiung";

        function getWeatherIcon(weather) {
            if (!weather) return "ğŸŒ¤ï¸";
            if (weather.includes("æ™´")) return "â˜€ï¸";
            if (weather.includes("å¤šé›²")) return "â›…";
            if (weather.includes("é™°")) return "â˜ï¸";
            if (weather.includes("é›¨")) return "ğŸŒ§ï¸";
            if (weather.includes("é›·")) return "â›ˆï¸";
            return "ğŸŒ¤ï¸";
        }

        function getAdvice(rainProb, maxTemp) {
            let rainIcon = "ğŸŒ‚";
            let rainText = "ä¸ç”¨å¸¶å‚˜";
            if (parseInt(rainProb) > 30) {
                rainIcon = "â˜‚ï¸";
                rainText = "è¨˜å¾—å¸¶å‚˜ï¼";
            }

            let clothIcon = "ğŸ‘•";
            let clothText = "èˆ’é©ç©¿æ­";
            if (parseInt(maxTemp) >= 28) {
                clothIcon = "ğŸ½";
                clothText = "çŸ­è¢–å‡ºç™¼";
            } else if (parseInt(maxTemp) <= 20) {
                clothIcon = "ğŸ§¥";
                clothText = "åŠ ä»¶å¤–å¥—";
            }

            return { rainIcon, rainText, clothIcon, clothText };
        }

        function getTimePeriod(startTime) {
            const hour = new Date(startTime).getHours();
            if (hour >= 5 && hour < 11) return "æ—©æ™¨";
            if (hour >= 11 && hour < 14) return "ä¸­åˆ";
            if (hour >= 14 && hour < 18) return "ä¸‹åˆ";
            if (hour >= 18 && hour < 23) return "æ™šä¸Š";
            return "æ·±å¤œ";
        }

        function renderWeather(data) {
            const forecasts = data.forecasts;
            const current = forecasts[0];
            const others = forecasts.slice(1);

            const advice = getAdvice(current.rain, current.maxTemp);
            const period = getTimePeriod(current.startTime);
            const avgTemp = Math.round((parseInt(current.maxTemp) + parseInt(current.minTemp)) / 2);

            // Hero
            document.getElementById('heroCard').innerHTML = `
                <div class="hero-period">${period}</div>
                <div class="hero-temp-container">
                    <div class="hero-icon">${getWeatherIcon(current.weather)}</div>
                    <div>
                        <div class="hero-temp">${avgTemp}Â°</div>
                        <div class="hero-desc">${current.weather}</div>
                        <div class="rain-prob">é™é›¨æ©Ÿç‡ï¼š${current.rain}%</div>
                    </div>
                </div>

                <div class="advice-grid">
                    <div class="advice-item">
                        <div class="advice-icon">${advice.rainIcon}</div>
                        <div class="advice-text">${advice.rainText}</div>
                        <div style="font-size:0.75rem; color:rgba(255,255,255,0.7); margin-top:6px;">é™é›¨ç‡ ${current.rain}%</div>
                    </div>
                    <div class="advice-item">
                        <div class="advice-icon">${advice.clothIcon}</div>
                        <div class="advice-text">${advice.clothText}</div>
                        <div style="font-size:0.75rem; color:rgba(255,255,255,0.7); margin-top:6px;">æœ€é«˜æº« ${current.maxTemp}Â°</div>
                    </div>
                </div>
            `;

            // future forecasts
            const scrollContainer = document.getElementById('futureForecasts');
            scrollContainer.innerHTML = '';

            const todayDate = new Date().getDate();

            others.forEach(f => {
                let p = getTimePeriod(f.startTime);
                const fDate = new Date(f.startTime);
                if (fDate.getDate() !== todayDate) p = 'æ˜å¤© ' + p;

                scrollContainer.innerHTML += `
                    <div class="mini-card">
                        <div class="mini-time">${p}</div>
                        <div class="mini-icon">${getWeatherIcon(f.weather)}</div>
                        <div class="mini-temp">${f.minTemp}Â° - ${f.maxTemp}Â°</div>
                        <div class="mini-rain">ğŸ’§ é™é›¨ ${f.rain}%</div>
                    </div>
                `;
            });

            // update time
            const now = new Date();
            const month = now.getMonth() + 1;
            const date = now.getDate();
            const dayIndex = now.getDay();
            const days = ["é€±æ—¥", "é€±ä¸€", "é€±äºŒ", "é€±ä¸‰", "é€±å››", "é€±äº”", "é€±å…­"];
            document.getElementById('updateTime').textContent = `${month}æœˆ${date}æ—¥ ${days[dayIndex]}`;
        }

        async function fetchWeather() {
            try {
                const delayPromise = new Promise(resolve => setTimeout(resolve, 900));
                const fetchPromise = fetch(API_URL).then(res => res.json());
                const [_, json] = await Promise.all([delayPromise, fetchPromise]);

                if (json.success) {
                    renderWeather(json.data);
                } else {
                    throw new Error('API Error');
                }
            } catch (e) {
                console.error(e);
                // åœ¨ hero card é¡¯ç¤ºéŒ¯èª¤æç¤º
                document.getElementById('heroCard').innerHTML = `
                    <div style="padding:20px; color:rgba(255,255,255,0.85);">å¤©æ°£è³‡æ–™è®€å–å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>
                `;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetchWeather();
        });
    </script>

</body>

</html>
